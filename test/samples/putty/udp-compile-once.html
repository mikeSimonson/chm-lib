<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=US-ASCII">
<title>Single compilation of each source file</title>
<link rel="previous" href="udp-ssh-coroutines.html">
<link rel="ToC" href="index.html">
<link rel="next" href="udp-perfection.html">
<link rel="stylesheet" type="text/css" href="chm.css"></head>
<body>
<h1><a name="udp-compile-once"></a>D.13 Single compilation of each source file</h1>
<p>
The PuTTY build system for any given platform works on the following very simple model:
</p>
<ul><li>
Each source file is compiled precisely once, to produce a single object file.
</li>
<li>
Each binary is created by linking together some combination of those object files.
</li>
</ul>
<p>
Therefore, if you need to introduce functionality to a particular module which is only available in some of the tool binaries (for example, a cryptographic proxy authentication mechanism which needs to be left out of PuTTYtel to maintain its usability in crypto-hostile jurisdictions), the <em>wrong</em> way to do it is by adding <code>#ifdef</code>s in (say) <code>proxy.c</code>. This would require separate compilation of <code>proxy.c</code> for PuTTY and PuTTYtel, which means that the entire <code>Makefile</code>-generation architecture (see <a href="udp-makefiles-auto.html#udp-makefiles-auto">section D.11</a>) would have to be significantly redesigned. Unless you are prepared to do that redesign yourself, <em>and</em> guarantee that it will still port to any future platforms we might decide to run on, you should not attempt this!
</p>
<p>
The <em>right</em> way to introduce a feature like this is to put the new code in a separate source file, and (if necessary) introduce a second new source file defining the same set of functions, but defining them as stubs which don't provide the feature. Then the module whose behaviour needs to vary (<code>proxy.c</code> in this example) can call the functions defined in these two modules, and it will either provide the new feature or not provide it according to which of your new modules it is linked with.
</p>
<p>
Of course, object files are never shared <em>between</em> platforms; so it is allowable to use <code>#ifdef</code> to select between platforms. This happens in <code>puttyps.h</code> (choosing which of the platform-specific include files to use), and also in <code>misc.c</code> (the Windows-specific &#8216;Minefield&#8217; memory diagnostic system). It should be used sparingly, though, if at all.
</p>

<!-- version IDs:
PuTTY release 0.67
-->
</body>
</html>
